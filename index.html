<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="sddefault.jpg">
    <title>–ë—ñ–±–ª—ñ–π–Ω—ñ —á–∏—Ç–∞–Ω–Ω—è</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); text-align: center; }
        h1 { color: #4a90e2; font-size: 2.5em; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 1.1em; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: rgba(255, 255, 255, 0.95); padding: 14px 10px; border-radius: 12px; box-shadow: 0 3px 12px rgba(0,0,0,0.08); text-align: center; transition: transform 0.2s ease; min-height: 80px; display: flex; flex-direction: column; justify-content: center; }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-number { font-size: 1.8em; font-weight: bold; color: #4a90e2; display: block; }
        .stat-label { color: #666; margin-top: 4px; font-size: 0.8em; }
        .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 10px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4a90e2, #357abd); transition: width 0.3s ease; }
        .main-content { display: grid; grid-template-columns: 300px 1fr; gap: 20px; margin-bottom: 20px; }
        .sidebar { background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); height: fit-content; position: sticky; top: 20px; }
        .create-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; border: none; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-bottom: 20px; transition: transform 0.2s; }
        .create-btn:hover { transform: scale(1.05); }
        .menu-section { margin-bottom: 20px; }
        .menu-section h3 { color: #4a90e2; margin-bottom: 10px; font-size: 1em; }
        .menu-item { padding: 12px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover, .menu-item.active { background: #4a90e2; color: white; border-color: #4a90e2; }
        .content-area { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .readings-grid { display: grid; gap: 15px; }
        .reading-card { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s; position: relative; }
        .reading-card:hover { box-shadow: 0 5px 20px rgba(74, 144, 226, 0.3); border-color: #4a90e2; }
        .reading-card.completed { border-left: 5px solid #4caf50; background: #f1f8f4; }
        .reading-card.current { border-left: 5px solid #ff9800; }
        .reading-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .reading-title { font-size: 1.3em; font-weight: bold; color: #333; }
        .reading-reference { color: #4a90e2; font-weight: 600; margin-bottom: 8px; }
        .reading-description { color: #666; line-height: 1.6; margin-bottom: 15px; font-size: 0.95em; }
        .reading-meta { display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.9em; color: #999; margin-bottom: 15px; }
        .checkbox-label { display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 600; }
        .checkbox-label input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .reading-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em; transition: all 0.3s; }
        .btn-ai { background: #9c27b0; color: white; }
        .btn-note { background: #2196f3; color: white; }
        .btn-delete { background: #f44336; color: white; }
        /* –Ω–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .btn-dictionary { background: #673ab7; color: white; }
        .btn-connections { background: #e91e63; color: white; }
        .dictionary-term {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #673ab7;
        }
        .dictionary-term strong {
            color: #673ab7;
            font-size: 1.1em;
            display: block;
            margin-bottom: 8px;
        }
        .connection-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #e91e63;
        }
        .connection-card strong {
            color: #e91e63;
            display: block;
            margin-bottom: 8px;
        }
        .notes-section { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 15px; display: none; }
        .notes-section.active { display: block; }
        .notes-section textarea { width: 100%; min-height: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; resize: vertical; font-family: inherit; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { color: #4a90e2; }
        .close-btn { font-size: 2em; cursor: pointer; color: #999; border: none; background: none; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; font-family: inherit; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-actions { display: flex; gap: 10px; justify-content: flex-end; }
        .btn-primary { background: #4a90e2; color: white; padding: 12px 30px; }
        .btn-secondary { background: #e0e0e0; color: #333; padding: 12px 30px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 4em; margin-bottom: 20px; }
        .plan-templates { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .template-card { background: linear-gradient(135deg, #f5f7fa 0%, #e3edf7 100%); padding: 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; text-align: center; }
        .template-card:hover { transform: translateY(-3px); border-color: #4a90e2; box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3); }
        .template-icon { font-size: 2.5em; margin-bottom: 10px; }
        .template-title { font-weight: bold; color: #333; margin-bottom: 5px; }
        .template-desc { font-size: 0.85em; color: #666; }
        .ai-suggestions { background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid #9c27b0; }
        .ai-response-box { background: linear-gradient(135deg, #f3e5f522 0%, #e1bee733 100%); padding: 20px; border-radius: 12px; border-left: 5px solid #9c27b0; margin-top: 15px; }
        .loading { text-align: center; padding: 40px; }
        .spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid #e0e0e0; border-top-color: #4a90e2; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .tag { display: inline-block; padding: 4px 12px; background: #e3f2fd; color: #1976d2; border-radius: 15px; font-size: 0.85em; margin-right: 5px; }
        .share-buttons { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .share-btn { padding: 10px 20px; border-radius: 8px; text-decoration: none; color: white; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; transition: transform 0.2s; }
        .share-btn:hover { transform: scale(1.05); }
        .share-telegram { background: #0088cc; }
        .share-save { background: #4caf50; }
        @media (max-width: 968px) { 
            .main-content { grid-template-columns: 1fr; } 
            h1 { font-size: 1.8em; } 
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .sidebar { position: static; }
            .form-group textarea { min-height: 150px; font-size: 16px; }
            .form-group select { font-size: 16px; padding: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–ë—ñ–±–ª—ñ–π–Ω—ñ —á–∏—Ç–∞–Ω–Ω—è</h1>
            <p class="subtitle">"–°–ª–æ–≤–æ –¢–≤–æ—î ‚Äî —Å–≤—ñ—Ç–∏–ª—å–Ω–∏–∫ –Ω–æ–∑—ñ –º–æ—ó–π —ñ —Å–≤—ñ—Ç–ª–æ —Å—Ç–µ–∂—Ü—ñ –º–æ—ó–π" - –ü—Å–∞–ª–æ–º 119:105</p>
        </header>
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="totalReadings">0</span>
                <div class="stat-label">–í—Å—å–æ–≥–æ —á–∏—Ç–∞–Ω—å</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="completedReadings">0</span>
                <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="currentStreak">0</span>
                <div class="stat-label">–ü–æ—Ç–æ—á–Ω–∞ —Å–µ—Ä—ñ—è</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="notesCount">0</span>
                <div class="stat-label">–ù–æ—Ç–∞—Ç–∫–∏</div>
            </div>
        </div>
        <div class="main-content">
            <aside class="sidebar">
                <button class="create-btn" onclick="app.openCreateModal()">+ –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–ª–∞–Ω</button>
                <div class="menu-section">
                    <h3>–ú–æ—ó –ø–ª–∞–Ω–∏</h3>
                    <div id="plansList"></div>
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="app.exportData()">üì• –ï–∫—Å–ø–æ—Ä—Ç</button>
                    <button class="btn btn-secondary" style="width: 100%;" onclick="app.openHelp()">? –î–æ–ø–æ–º–æ–≥–∞</button>
                </div>
            </aside>
            <main class="content-area">
                <div id="contentArea">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìñ</div>
                        <h3>–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω—É</h3>
                        <p>–°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø–ª–∞–Ω —á–∏—Ç–∞–Ω–Ω—è –¥–ª—è –ø–æ—á–∞—Ç–∫—É</p>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <!-- Modal: Create Plan -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>+ –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–ª–∞–Ω —á–∏—Ç–∞–Ω–Ω—è</h2>
                <button class="close-btn" onclick="app.closeCreateModal()">&times;</button>
            </div>
            <div class="plan-templates">
                <div class="template-card" onclick="app.selectTemplate('custom')">
                    <div class="template-icon">‚úèÔ∏è</div>
                    <div class="template-title">–°–≤—ñ–π –ø–ª–∞–Ω</div>
                    <div class="template-desc">–í–ª–∞—Å–Ω–∏–π –ø–ª–∞–Ω —á–∏—Ç–∞–Ω–Ω—è</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('year')">
                    <div class="template-icon">üìÖ</div>
                    <div class="template-title">–†—ñ–∫</div>
                    <div class="template-desc">365 –¥–Ω—ñ–≤</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('nt')">
                    <div class="template-icon">‚úùÔ∏è</div>
                    <div class="template-title">–ù–æ–≤–∏–π –ó–∞–ø–æ–≤—ñ—Ç</div>
                    <div class="template-desc">3 –º—ñ—Å—è—Ü—ñ</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('gospels')">
                    <div class="template-icon">üìñ</div>
                    <div class="template-title">–Ñ–≤–∞–Ω–≥–µ–ª—ñ—è</div>
                    <div class="template-desc">30 –¥–Ω—ñ–≤</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('psalms')">
                    <div class="template-icon">üéµ</div>
                    <div class="template-title">–ü—Å–∞–ª–º–∏</div>
                    <div class="template-desc">150 –ø—Å–∞–ª–º—ñ–≤</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('wisdom')">
                    <div class="template-icon">üß†</div>
                    <div class="template-title">–ú—É–¥—Ä—ñ—Å—Ç—å</div>
                    <div class="template-desc">–ü—Ä–∏—Ç—á—ñ, –ï–∫–∫–ª–µ–∑—ñ–∞—Å—Ç</div>
                </div>
            </div>
            <div class="ai-suggestions">
                <h3 style="margin-bottom: 15px;">ü§ñ AI –¥–æ–ø–æ–º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–ª–∞–Ω</h3>
                <div class="form-group">
                    <label>–û–ø–∏—à—ñ—Ç—å –±–∞–∂–∞–Ω–∏–π –ø–ª–∞–Ω —á–∏—Ç–∞–Ω–Ω—è:</label>
                    <select id="aiPreset" onchange="app.selectAIPreset()" style="margin-bottom: 10px;">
                        <option value="">-- –û–±–µ—Ä—ñ—Ç—å —à–∞–±–ª–æ–Ω --</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞ 7 –¥–Ω—ñ–≤">–ß–∏—Ç–∞–Ω–Ω—è –ø–æ–≤–Ω—ñ—Å—Ç—é (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ù–æ–≤–æ–≥–æ –ó–∞–ø–æ–≤—ñ—Ç—É –∑–∞ 7 –¥–Ω—ñ–≤">–ù–ó –∑–∞ —Ç–∏–∂–¥–µ–Ω—å (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ü—Å–∞–ª–º—ñ–≤ —ñ –ü—Ä–æ—Ä–æ–∫—ñ–≤ –∑–∞ 2 —Ç–∏–∂–Ω—ñ">–ü—Å–∞–ª–º–∏ —ñ –ü—Ä–æ—Ä–æ–∫–∏ (14 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –ø–æ –ø–æ—Ä—è–¥–∫—É –∑–∞ 7 –¥–Ω—ñ–≤">–ü–æ –ø–æ—Ä—è–¥–∫—É (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –ø–æ —Ç–µ–º–∞—Ö –∑–∞ 10 –¥–Ω—ñ–≤">–ü–æ —Ç–µ–º–∞—Ö (10 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º–∏ –∑–∞ 2 —Ç–∏–∂–Ω—ñ">–ó –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º–∏ (14 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –º–æ–ª–∏—Ç–≤–∞–º–∏ —ñ —Ä–æ–∑–¥—É–º–∞–º–∏ 7 –¥–Ω—ñ–≤">–ó –º–æ–ª–∏—Ç–≤–∞–º–∏ —ñ —Ä–æ–∑–¥—É–º–∞–º–∏ (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∂–∏—Ç—Ç—è –Ü—Å—É—Å–∞ –•—Ä–∏—Å—Ç–∞ –∑–∞ 7 –¥–Ω—ñ–≤">–ñ–∏—Ç—Ç—è –Ü—Å—É—Å–∞ –•—Ä–∏—Å—Ç–∞ (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –º–∏–ª–æ—Å–µ—Ä–¥—è –∑–∞ 10 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –º–∏–ª–æ—Å–µ—Ä–¥—è (10 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –ø—Ä–æ—Ä–æ–∫—ñ–≤ –∑–∞ 9 –¥–Ω—ñ–≤">–ü—Ä–æ—Ä–æ–∫–∏ (9 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –ü—Å–∞–ª–º–∞–º–∏ —ñ –ü—Ä–∏—Ç—á–∞–º–∏ –∑–∞ 7 –¥–Ω—ñ–≤">–ü—Å–∞–ª–º–∏ —ñ –ü—Ä–∏—Ç—á—ñ (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –Ω–∞–¥—ñ—é —ñ –≤—ñ—Ä—É 7 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –Ω–∞–¥—ñ—é —ñ –≤—ñ—Ä—É (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ª—é–±–æ–≤ —ñ –ø—Ä–æ—â–µ–Ω–Ω—è 7 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –ª—é–±–æ–≤ —ñ –ø—Ä–æ—â–µ–Ω–Ω—è (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ñ—Å—Ç—å 10 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ñ—Å—Ç—å (10 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –º—É–¥—Ä—ñ—Å—Ç—å 14 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –º—É–¥—Ä—ñ—Å—Ç—å (14 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø–æ–∫–∞—è–Ω–Ω—è 7 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –ø–æ–∫–∞—è–Ω–Ω—è (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –≤—ñ—Ä—É —ñ –¥–æ–≤—ñ—Ä—É 10 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –≤—ñ—Ä—É —ñ –¥–æ–≤—ñ—Ä—É (10 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Å–ª—É–∂—ñ–Ω–Ω—è 7 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ —Å–ª—É–∂—ñ–Ω–Ω—è (7 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –¶–∞—Ä—Å—Ç–≤–æ –ë–æ–∂–µ 30 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –¶–∞—Ä—Å—Ç–≤–æ –ë–æ–∂–µ (30 –¥–Ω—ñ–≤)</option>
                        <option value="–ß–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –∂–∏—Ç—Ç—è –≤ –î—É—Å—ñ 14 –¥–Ω—ñ–≤">–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –∂–∏—Ç—Ç—è –≤ –î—É—Å—ñ (14 –¥–Ω—ñ–≤)</option>
                    </select>
                    <textarea id="aiPrompt" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –°—Ç–≤–æ—Ä–∏ –ø–ª–∞–Ω —á–∏—Ç–∞–Ω–Ω—è –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –º–∏–ª–æ—Å–µ—Ä–¥—è –Ω–∞ 10 –¥–Ω—ñ–≤..." style="min-height: 80px;"></textarea>
                </div>
                <button class="btn btn-primary" onclick="app.generateAIPlan()">ü§ñ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–ª–∞–Ω</button>
            </div>
            <div id="manualPlanForm" style="display: none;">
                <form onsubmit="app.saveManualPlan(event)">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞ –ø–ª–∞–Ω—É *</label>
                        <input type="text" id="planName" required>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å</label>
                        <textarea id="planDescription"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="app.closeCreateModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        <button type="submit" class="btn btn-primary">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Modal: AI Helper -->
    <div class="modal" id="aiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ü§ñ AI-–ø–æ–º—ñ—á–Ω–∏–∫</h2>
                <button class="close-btn" onclick="app.closeAIModal()">&times;</button>
            </div>
            <div style="margin-bottom: 20px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <strong id="aiReadingTitle"></strong>
                    <p id="aiReadingRef" style="color: #4a90e2; margin-top: 5px;"></p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="app.getAIHelp('summary')">üìñ –ö–æ—Ä–æ—Ç–∫–∏–π –æ–≥–ª—è–¥</button>
                    <button class="btn btn-primary" onclick="app.getAIHelp('context')">üìñ –ö–æ–Ω—Ç–µ–∫—Å—Ç</button>
                    <button class="btn btn-primary" onclick="app.getAIHelp('parallels')">üìñ –ü–∞—Ä–∞–ª–µ–ª—ñ</button>
                    <button class="btn btn-primary" onclick="app.getAIHelp('application')">üìñ –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è</button>
                </div>
                <div id="aiHelpResponse" style="display: none;"></div>
                <div id="aiHelpLoading" style="display: none;" class="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 15px; color: #666;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="btn btn-secondary" onclick="app.closeAIModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
            </div>
        </div>
    </div>
    <!-- Modal: Help -->
    <div class="modal" id="helpModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>? –î–æ–ø–æ–º–æ–≥–∞</h2>
                <button class="close-btn" onclick="app.closeHelp()">&times;</button>
            </div>
            <div style="line-height: 1.8; color: #333;">
                <div style="background: linear-gradient(135deg, #4a90e222 0%, #357abd33 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px; border-left: 5px solid #4a90e2;">
                    <h3 style="color: #4a90e2; margin-bottom: 10px;">üéâ –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ!</h3>
                    <p>–¶–µ–π –¥–æ–¥–∞—Ç–æ–∫ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞—Ç–∏ —á–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó. –°—Ç–≤–æ—Ä—é–π—Ç–µ –ø–ª–∞–Ω–∏, –≤—ñ–¥–º—ñ—á–∞–π—Ç–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–µ, —Ä–æ–±—ñ—Ç—å –Ω–æ—Ç–∞—Ç–∫–∏ —Ç–∞ –æ—Ç—Ä–∏–º—É–π—Ç–µ –¥–æ–ø–æ–º–æ–≥—É –≤—ñ–¥ AI.</p>
                </div>
                <h3 style="color: #4a90e2; margin-bottom: 15px;">? –Ø–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è</h3>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #2196f3; margin-bottom: 8px;">1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∞–Ω—É</h4>
                    <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "+ –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–ª–∞–Ω" —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å —à–∞–±–ª–æ–Ω –∞–±–æ —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è AI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–ª–∞–Ω—É —á–∏—Ç–∞–Ω–Ω—è.</p>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #4caf50; margin-bottom: 8px;">2. –í—ñ–¥–º—ñ—á–∞–Ω–Ω—è —á–∏—Ç–∞–Ω—å</h4>
                    <p>–ü—ñ—Å–ª—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è –≤—ñ–¥–º—ñ—Ç—å—Ç–µ —á–∏—Ç–∞–Ω–Ω—è —è–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–µ. –¶–µ –¥–æ–ø–æ–º–æ–∂–µ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å.</p>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #9c27b0; margin-bottom: 8px;">3. AI-–ø–æ–º—ñ—á–Ω–∏–∫</h4>
                    <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "ü§ñ AI-–ø–æ–º—ñ—á–Ω–∏–∫" –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É —á–∏—Ç–∞–Ω–Ω—ñ, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –æ–≥–ª—è–¥, –∫–æ–Ω—Ç–µ–∫—Å—Ç, –ø–∞—Ä–∞–ª–µ–ª—ñ —Ç–∞ –ø—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è.</p>
                </div>
                <h3 style="color: #4a90e2; margin-bottom: 15px; margin-top: 25px;">? –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ AI</h3>
                <ul style="padding-left: 20px;">
                    <li><strong>–ö–æ—Ä–æ—Ç–∫–∏–π –æ–≥–ª—è–¥:</strong> AI –Ω–∞–¥–∞—î —Å—Ç–∏—Å–ª–∏–π –∑–º—ñ—Å—Ç —á–∏—Ç–∞–Ω–Ω—è</li>
                    <li><strong>–ö–æ–Ω—Ç–µ–∫—Å—Ç:</strong> –Ü—Å—Ç–æ—Ä–∏—á–Ω–∏–π —Ç–∞ –±–æ–≥–æ—Å–ª–æ–≤—Å—å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç</li>
                    <li><strong>–ü–∞—Ä–∞–ª–µ–ª—ñ:</strong> –ü–æ—à—É–∫ —Å—Ö–æ–∂–∏—Ö —É—Ä–∏–≤–∫—ñ–≤ —É –ë—ñ–±–ª—ñ—ó</li>
                    <li><strong>–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è:</strong> –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø–æ—Ä–∞–¥–∏ –¥–ª—è –∂–∏—Ç—Ç—è</li>
                    <li><strong>–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è:</strong> –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ AI-–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —è–∫ —Ç–µ–∫—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏</li>
                </ul>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; border-left: 5px solid #4caf50; margin-top: 20px;">
                    <p style="margin: 0;"><strong>? –í–∞–∂–ª–∏–≤–æ:</strong> AI ‚Äî —Ü–µ –¥–æ–ø–æ–º—ñ–∂–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∞ –Ω–µ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–∞ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è –°–≤—è—Ç–æ–≥–æ –ü–∏—Å—å–º–∞.</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="app.closeHelp()">–ó—Ä–æ–∑—É–º—ñ–ª–æ! –î—è–∫—É—é</button>
            </div>
        </div>
    </div>
    <script>
        const app = {
            plans: [],
            currentPlan: null,
            currentReading: null,
            lastAIResponse: null,
            API_KEY: atob("Z3NrX1NUelQyS1FFQko3MGNDb1hDSllaV0dkeWIzRlk5OHJHN2xvWXUxSmc1SnV0VFZOSzIyVHY="),
            API_URL: "https://api.groq.com/openai/v1/chat/completions",
            MODEL_NAME: "meta-llama/llama-4-maverick-17b-128e-instruct",
            init() {
                this.loadPlans();
                this.updateStats();
                this.renderPlans();
                this.renderContent();
            },
            loadPlans() {
                const saved = localStorage.getItem('biblePlans');
                if (saved) {
                    this.plans = JSON.parse(saved);
                }
            },
            savePlans() {
                localStorage.setItem('biblePlans', JSON.stringify(this.plans));
                this.updateStats();
                this.renderPlans();
                this.renderContent();
            },
            updateStats() {
                let totalReadings = 0;
                let completedReadings = 0;
                let notesCount = 0;
                let lastReadDate = null;
                this.plans.forEach(plan => {
                    totalReadings += plan.readings.length;
                    plan.readings.forEach(r => {
                        if (r.completed) {
                            completedReadings++;
                            if (r.completedDate) {
                                const date = new Date(r.completedDate).toDateString();
                                if (!lastReadDate || new Date(r.completedDate) > new Date(lastReadDate)) {
                                    lastReadDate = r.completedDate;
                                }
                            }
                        }
                        if (r.notes) notesCount++;
                    });
                });
                const streak = this.calculateStreak();
                const progress = totalReadings > 0 ? Math.round((completedReadings / totalReadings) * 100) : 0;
                document.getElementById('totalReadings').textContent = totalReadings;
                document.getElementById('completedReadings').textContent = completedReadings;
                document.getElementById('currentStreak').textContent = streak;
                document.getElementById('notesCount').textContent = notesCount;
                document.getElementById('progressBar').style.width = progress + '%';
            },
            calculateStreak() {
                const allReadings = [];
                this.plans.forEach(plan => {
                    plan.readings.forEach(r => {
                        if (r.completed && r.completedDate) {
                            allReadings.push(new Date(r.completedDate));
                        }
                    });
                });
                if (allReadings.length === 0) return 0;
                allReadings.sort((a, b) => b - a);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                let streak = 0;
                let checkDate = new Date(today);
                for (let i = 0; i < allReadings.length; i++) {
                    const readDate = new Date(allReadings[i]);
                    readDate.setHours(0, 0, 0, 0);
                    if (readDate.getTime() === checkDate.getTime()) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else if (readDate < checkDate) {
                        break;
                    }
                }
                return streak;
            },
            renderPlans() {
                const container = document.getElementById('plansList');
                if (this.plans.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">–ù–µ–º–∞—î –ø–ª–∞–Ω—ñ–≤</div>';
                    return;
                }
                container.innerHTML = this.plans.map((plan, index) => {
                    const completed = plan.readings.filter(r => r.completed).length;
                    const total = plan.readings.length;
                    const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                    const isActive = this.currentPlan && this.currentPlan.id === plan.id;
                    return `
                        <div class="menu-item ${isActive ? 'active' : ''}" onclick="app.selectPlan(${plan.id})">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; margin-bottom: 5px;">${plan.name}</div>
                                <div style="font-size: 0.85em; opacity: 0.8;">${completed}/${total} (${progress}%)</div>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            renderContent() {
                const container = document.getElementById('contentArea');
                if (!this.currentPlan) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìñ</div>
                            <h3>–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω—É</h3>
                            <p>–û–±–µ—Ä—ñ—Ç—å –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø–ª–∞–Ω —á–∏—Ç–∞–Ω–Ω—è</p>
                        </div>
                    `;
                    return;
                }
                const plan = this.currentPlan;
                const completed = plan.readings.filter(r => r.completed).length;
                const total = plan.readings.length;
                const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                container.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2 style="color: #4a90e2;">${plan.name}</h2>
                            ${plan.description ? `<p style="color: #666; margin-top: 5px;">${plan.description}</p>` : ''}
                        </div>
                        <button class="btn btn-delete" onclick="app.deletePlan(${plan.id})">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ –ø–ª–∞–Ω</button>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span><strong>–ü—Ä–æ–≥—Ä–µ—Å:</strong> ${completed} –∑ ${total}</span>
                            <span><strong>${progress}%</strong></span>
                        </div>
                        <div class="progress-bar" style="height: 10px;">
                            <div class="progress-fill" style="width: ${progress}%;"></div>
                        </div>
                    </div>
                    <div class="readings-grid">
                        ${plan.readings.map((reading, index) => `
                            <div class="reading-card ${reading.completed ? 'completed' : ''} ${index === 0 && !reading.completed ? 'current' : ''}">
                                <div class="reading-header">
                                    <div style="flex: 1;">
                                        <div class="reading-title">–ß–∏—Ç–∞–Ω–Ω—è ${index + 1}</div>
                                        <div class="reading-reference">${reading.reference}</div>
                                        ${reading.theme ? `<span class="tag">${reading.theme}</span>` : ''}
                                    </div>
                                    <label class="checkbox-label">
                                        <input type="checkbox" ${reading.completed ? 'checked' : ''} onchange="app.toggleComplete(${plan.id}, ${index})">
                                        <span>${reading.completed ? '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ' : '–ó–∞–≤–µ—Ä—à–∏—Ç–∏'}</span>
                                    </label>
                                </div>
                                ${reading.description ? `<div class="reading-description">${reading.description}</div>` : ''}
                                <div class="reading-meta">
                                    ${reading.completed && reading.completedDate ? `<span>üìÖ ${new Date(reading.completedDate).toLocaleDateString('uk-UA')}</span>` : ''}
                                    ${reading.notes ? `<span>üìù –ó –Ω–æ—Ç–∞—Ç–∫–∞–º–∏</span>` : ''}
                                </div>
                                <div class="reading-actions">
                                    <button class="btn btn-ai" onclick="app.openAIHelper(${plan.id}, ${index})">ü§ñ AI-–ø–æ–º—ñ—á–Ω–∏–∫</button>
                                    <button class="btn btn-note" onclick="app.toggleNotes(${plan.id}, ${index})">üìù –ù–æ—Ç–∞—Ç–∫–∏</button>
                                    <button class="btn btn-dictionary" onclick="app.getBibleDictionary(${plan.id}, ${index})">üìö –°–ª–æ–≤–Ω–∏–∫</button>
                                    <button class="btn btn-connections" onclick="app.getConnections(${plan.id}, ${index})">üîó –ó–≤‚Äô—è–∑–∫–∏</button>
                                </div>
                                <div class="notes-section" id="notes-${plan.id}-${index}">
                                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">–í–∞—à—ñ –Ω–æ—Ç–∞—Ç–∫–∏:</label>
                                    <textarea id="noteText-${plan.id}-${index}" onchange="app.saveNote(${plan.id}, ${index})">${reading.notes || ''}</textarea>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            },
            selectPlan(planId) {
                this.currentPlan = this.plans.find(p => p.id === planId);
                this.renderPlans();
                this.renderContent();
            },
            toggleComplete(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const reading = plan.readings[readingIndex];
                reading.completed = !reading.completed;
                reading.completedDate = reading.completed ? new Date().toISOString() : null;
                this.savePlans();
            },
            toggleNotes(planId, readingIndex) {
                const notesSection = document.getElementById(`notes-${planId}-${readingIndex}`);
                if (notesSection) {
                    notesSection.classList.toggle('active');
                }
            },
            saveNote(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const noteText = document.getElementById(`noteText-${plan.id}-${readingIndex}`).value;
                plan.readings[readingIndex].notes = noteText;
                this.savePlans();
            },
            deletePlan(planId) {
                if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –ø–ª–∞–Ω?')) return;
                this.plans = this.plans.filter(p => p.id !== planId);
                if (this.currentPlan && this.currentPlan.id === planId) {
                    this.currentPlan = null;
                }
                this.savePlans();
            },
            openCreateModal() {
                document.getElementById('createModal').classList.add('active');
                document.getElementById('manualPlanForm').style.display = 'none';
                document.getElementById('aiPrompt').value = '';
                document.getElementById('aiPreset').value = '';
            },
            closeCreateModal() {
                document.getElementById('createModal').classList.remove('active');
            },
            selectAIPreset() {
                const select = document.getElementById('aiPreset');
                const textarea = document.getElementById('aiPrompt');
                if (select.value) {
                    textarea.value = select.value;
                }
            },
            selectTemplate(template) {
                const templates = {
                    custom: {
                        name: '–°–≤—ñ–π –ø–ª–∞–Ω',
                        description: '–í–ª–∞—Å–Ω–∏–π –ø–ª–∞–Ω —á–∏—Ç–∞–Ω–Ω—è',
                        readings: []
                    },
                    year: {
                        name: '–ß–∏—Ç–∞–Ω–Ω—è –Ω–∞ —Ä—ñ–∫',
                        description: '–ü–æ–≤–Ω–µ —á–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó –∑–∞ 365 –¥–Ω—ñ–≤',
                        readings: this.generateYearPlan()
                    },
                    nt: {
                        name: '–ù–æ–≤–∏–π –ó–∞–ø–æ–≤—ñ—Ç',
                        description: '–ß–∏—Ç–∞–Ω–Ω—è –ù–æ–≤–æ–≥–æ –ó–∞–ø–æ–≤—ñ—Ç—É –∑–∞ 90 –¥–Ω—ñ–≤',
                        readings: this.generateNTPlan()
                    },
                    gospels: {
                        name: '–Ñ–≤–∞–Ω–≥–µ–ª—ñ—è',
                        description: '–ß–∏—Ç–∞–Ω–Ω—è —á–æ—Ç–∏—Ä—å–æ—Ö —î–≤–∞–Ω–≥–µ–ª—ñ–π –ø–æ –ø–æ—Ä—è–¥–∫—É',
                        readings: this.generateGospelsPlan()
                    },
                    psalms: {
                        name: '–ü—Å–∞–ª–º–∏',
                        description: '–í—Å—ñ 150 –ø—Å–∞–ª–º—ñ–≤ –ø–æ –ø–æ—Ä—è–¥–∫—É',
                        readings: this.generatePsalmsPlan()
                    },
                    wisdom: {
                        name: '–ö–Ω–∏–≥–∏ –º—É–¥—Ä–æ—Å—Ç—ñ',
                        description: '–ü—Ä–∏—Ç—á—ñ, –ï–∫–∫–ª–µ–∑—ñ–∞—Å—Ç, –ö–Ω–∏–≥–∞ –ô–æ–≤–∞',
                        readings: this.generateWisdomPlan()
                    }
                };
                if (template === 'custom') {
                    document.getElementById('manualPlanForm').style.display = 'block';
                } else {
                    const planData = templates[template];
                    const plan = {
                        id: Date.now(),
                        name: planData.name,
                        description: planData.description,
                        readings: planData.readings,
                        createdDate: new Date().toISOString()
                    };
                    this.plans.unshift(plan);
                    this.currentPlan = plan;
                    this.savePlans();
                    this.closeCreateModal();
                }
            },
            saveManualPlan(e) {
                e.preventDefault();
                const plan = {
                    id: Date.now(),
                    name: document.getElementById('planName').value,
                    description: document.getElementById('planDescription').value,
                    readings: [],
                    createdDate: new Date().toISOString()
                };
                this.plans.unshift(plan);
                this.currentPlan = plan;
                this.savePlans();
                this.closeCreateModal();
            },
            async generateAIPlan() {
                const prompt = document.getElementById('aiPrompt').value.trim();
                if (!prompt) {
                    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å, —è–∫–∏–π –ø–ª–∞–Ω –≤–∏ —Ö–æ—á–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏');
                    return;
                }
                const loading = document.createElement('div');
                loading.className = 'loading';
                loading.innerHTML = '<div class="spinner"></div><p style="margin-top: 15px;">–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–ª–∞–Ω—É...</p>';
                document.querySelector('#createModal .modal-content').appendChild(loading);
                try {
                    const systemPrompt = `–í–∏ ‚Äî –µ–∫—Å–ø–µ—Ä—Ç –∑ –±—ñ–±–ª—ñ–π–Ω–∏—Ö —á–∏—Ç–∞–Ω—å. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–ª–∞–Ω —á–∏—Ç–∞–Ω–Ω—è –ë—ñ–±–ª—ñ—ó.
–í–∏–º–æ–≥–∏: –ü–æ–≤–µ—Ä–Ω—ñ—Ç—å –≤–∏–∫–ª—é—á–Ω–æ JSON –∑ –Ω–∞—Å—Ç—É–ø–Ω–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é:
{
  "name": "–ù–∞–∑–≤–∞ –ø–ª–∞–Ω—É —á–∏—Ç–∞–Ω–Ω—è",
  "description": "–û–ø–∏—Å —Ü—å–æ–≥–æ –ø–ª–∞–Ω—É —á–∏—Ç–∞–Ω–Ω—è",
  "readings": [
    {
      "reference": "–ö–Ω–∏–≥–∞ –≥–ª–∞–≤–∏:—Å—Ç—ñ—Ö–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –ú–∞—Ç–≤—ñ—è 5-7)",
      "theme": "–¢–µ–º–∞ —á–∏—Ç–∞–Ω–Ω—è (1-3 —Å–ª–æ–≤–∞)",
      "description": "–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —Ü—å–æ–≥–æ —á–∏—Ç–∞–Ω–Ω—è (1 —Ä–µ—á–µ–Ω–Ω—è)"
    }
  ]
}
–í–∏–º–æ–≥–∏:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ª–∏—à–µ —ñ—Å–Ω—É—é—á—ñ –∫–Ω–∏–≥–∏ –ë—ñ–±–ª—ñ—ó
- reference –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–∏–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: "–ë—É—Ç—Ç—è 1-2", "–ü—Å–∞–ª–æ–º 23", "–†–∏–º–ª—è–Ω–∞–º 1-3")
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —á–∏—Ç–∞–Ω—å –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ —Ä–æ–∑—É–º–Ω–æ—é (7-90 –¥–Ω—ñ–≤)
- theme - –∫–æ—Ä–æ—Ç–∫–∞ —Ç–µ–º–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: "–ù–∞–≥—ñ—Ä–Ω–∞ –ø—Ä–æ–ø–æ–≤—ñ–¥—å")
- description - 1 —Ä–µ—á–µ–Ω–Ω—è –¥–ª—è –æ–ø–∏—Å—É`;
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: this.MODEL_NAME,
                            messages: [
                                { role: 'system', content: systemPrompt },
                                { role: 'user', content: prompt }
                            ],
                            max_tokens: 2000,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    let aiText = data.choices[0].message.content.trim();
                    aiText = aiText.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                    const planData = JSON.parse(aiText);
                    planData.readings = planData.readings.map(r => ({
                        ...r,
                        completed: false,
                        completedDate: null,
                        notes: ''
                    }));
                    const plan = {
                        id: Date.now(),
                        name: planData.name,
                        description: planData.description,
                        readings: planData.readings,
                        createdDate: new Date().toISOString(),
                        aiGenerated: true
                    };
                    this.plans.unshift(plan);
                    this.currentPlan = plan;
                    this.savePlans();
                    this.closeCreateModal();
                } catch (error) {
                    console.error('AI Error:', error);
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–ª–∞–Ω—É. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —ñ–Ω—à–∏–π –æ–ø–∏—Å.');
                } finally {
                    loading.remove();
                }
            },
            openAIHelper(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const reading = plan.readings[readingIndex];
                this.currentReading = { planId, readingIndex, reading };
                document.getElementById('aiReadingTitle').textContent = `–ß–∏—Ç–∞–Ω–Ω—è ${readingIndex + 1}`;
                document.getElementById('aiReadingRef').textContent = reading.reference;
                document.getElementById('aiHelpResponse').style.display = 'none';
                document.getElementById('aiModal').classList.add('active');
            },
            closeAIModal() {
                document.getElementById('aiModal').classList.remove('active');
                this.currentReading = null;
            },
            async getAIHelp(type) {
                if (!this.currentReading) return;
                const { reading } = this.currentReading;
                document.getElementById('aiHelpResponse').style.display = 'none';
                document.getElementById('aiHelpLoading').style.display = 'block';
                const prompts = {
                    summary: `–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –æ–≥–ª—è–¥ (3-5 —Ä–µ—á–µ–Ω—å) –±—ñ–±–ª—ñ–π–Ω–æ–≥–æ —É—Ä–∏–≤–∫—É: ${reading.reference}. 
–ü–∏—à–∏ –ø—Ä–æ—Å—Ç–æ—é –º–æ–≤–æ—é. –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –±–æ–≥–æ—Å–ª–æ–≤—Å—å–∫—ñ —Ç–µ—Ä–º—ñ–Ω–∏, —è–∫—â–æ –≤–æ–Ω–∏ –Ω–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ.`,
                    context: `–ü–æ—è—Å–Ω–∏ —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –±—ñ–±–ª—ñ–π–Ω–æ–≥–æ —É—Ä–∏–≤–∫—É: ${reading.reference}.
–û–ø–∏—à–∏ –¥–µ—Ç–∞–ª—å–Ω–æ, 4-6 —Ä–µ—á–µ–Ω—å: —Ö—Ç–æ –∞–≤—Ç–æ—Ä, –∫–æ–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω–æ, –¥–ª—è –∫–æ–≥–æ, —è–∫–∞ —Å–∏—Ç—É–∞—Ü—ñ—è, –≥–æ–ª–æ–≤–Ω–∞ –¥—É–º–∫–∞, –∫—É–ª—å—Ç—É—Ä–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.`,
                    parallels: `–ó–Ω–∞–π–¥–∏ 3-4 –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ —É—Ä–∏–≤–∫–∏ —É –ë—ñ–±–ª—ñ—ó –¥–ª—è: ${reading.reference}.
–§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
üìñ [–ü–æ—Å–∏–ª–∞–Ω–Ω—è] - –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –ø–∞—Ä–∞–ª–µ–ª—ñ
–û–ø–∏—Å –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∑—Ä–æ–∑—É–º—ñ–ª–∏–º –¥–ª—è —Å—É—á–∞—Å–Ω–æ—ó –ª—é–¥–∏–Ω–∏.`,
                    application: `–Ø–∫ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —É—Ä–∏–≤–æ–∫ ${reading.reference} —É —Å—É—á–∞—Å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ.
2-3 –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø–æ—Ä–∞–¥–∏:
üìñ [–ü–æ—Ä–∞–¥–∞] - —è–∫ —Å–∞–º–µ —Ü–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏
–û–ø–∏—Å –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º —ñ –ø—Ä–∞–∫—Ç–∏—á–Ω–∏–º.`
                };
                this.lastAIResponse = {
                    type: type,
                    reference: reading.reference,
                    theme: reading.theme || '–ë—ñ–±–ª—ñ–π–Ω–µ —á–∏—Ç–∞–Ω–Ω—è'
                };
                try {
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: this.MODEL_NAME,
                            messages: [
                                {
                                    role: 'system',
                                    content: '–í–∏ ‚Äî –µ–∫—Å–ø–µ—Ä—Ç –∑ –±—ñ–±–ª—ñ–π–Ω–∏—Ö —Å—Ç—É–¥—ñ–π. –í–∞—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ —Ç–æ—á–Ω–∏–º–∏, –∑—Ä–æ–∑—É–º—ñ–ª–∏–º–∏ —Ç–∞ –ø—Ä–∞–∫—Ç–∏—á–Ω–∏–º–∏. –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–∞–¥–º—ñ—Ä–Ω–æ –±–æ–≥–æ—Å–ª–æ–≤—Å—å–∫—É —Ç–µ—Ä–º—ñ–Ω–æ–ª–æ–≥—ñ—é, –ø–∏—à—ñ—Ç—å –ø—Ä–æ—Å—Ç–æ—é –º–æ–≤–æ—é.'
                                },
                                {
                                    role: 'user',
                                    content: prompts[type]
                                }
                            ],
                            max_tokens: 600,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    const aiText = data.choices[0].message.content;
                    this.lastAIResponse.content = aiText;
                    const typeNames = {
                        summary: 'üìñ –ö–æ—Ä–æ—Ç–∫–∏–π –æ–≥–ª—è–¥',
                        context: 'üìñ –ö–æ–Ω—Ç–µ–∫—Å—Ç',
                        parallels: 'üìñ –ü–∞—Ä–∞–ª–µ–ª—ñ',
                        application: 'üìñ –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è'
                    };
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').style.display = 'block';
                    document.getElementById('aiHelpResponse').innerHTML = `
                        <div class="ai-response-box">
                            <div style="line-height: 1.8; white-space: pre-wrap;">${aiText}</div>
                        </div>
                        <div class="share-buttons">
                            <a href="#" onclick="app.shareToTelegram(); return false;" class="share-btn share-telegram">
                                üì§ –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –≤ Telegram
                            </a>
                            <a href="#" onclick="app.saveAsTextFile(); return false;" class="share-btn share-save">
                                üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ —Ñ–∞–π–ª
                            </a>
                        </div>
                    `;
                } catch (error) {
                    console.error('AI Error:', error);
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').style.display = 'block';
                    document.getElementById('aiHelpResponse').innerHTML = `
                        <div class="ai-response-box">
                            <div style="color: #f44336;">–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.</div>
                        </div>
                    `;
                }
            },
            /* ========== –ù–û–í–Ü –ú–ï–¢–û–î–ò ========== */
            /* üìö –°–ª–æ–≤–Ω–∏–∫ –±—ñ–±–ª—ñ–π–Ω–∏—Ö —Ç–µ—Ä–º—ñ–Ω—ñ–≤ */
            async getBibleDictionary(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const reading = plan.readings[readingIndex];
                this.currentReading = { planId, readingIndex, reading };
                document.getElementById('aiReadingTitle').textContent = 'üìö –°–ª–æ–≤–Ω–∏–∫ —Ç–µ—Ä–º—ñ–Ω—ñ–≤';
                document.getElementById('aiReadingRef').textContent = reading.reference;
                document.getElementById('aiHelpResponse').style.display = 'none';
                document.getElementById('aiHelpLoading').style.display = 'block';
                document.getElementById('aiModal').classList.add('active');
                const prompt = `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –±—ñ–±–ª—ñ–π–Ω–∏–π —Ç–µ–∫—Å—Ç ${reading.reference} —ñ –∑–Ω–∞–π–¥–∏ 4-6 –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏—Ö —Ç–µ—Ä–º—ñ–Ω—ñ–≤ –∞–±–æ –ø–æ–Ω—è—Ç—å, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –ø–æ—è—Å–Ω–µ–Ω–Ω—è.
–î–ª—è –ö–û–ñ–ù–û–ì–û —Ç–µ—Ä–º—ñ–Ω—É –¥–∞–π:
1. –ù–∞–∑–≤—É —Ç–µ—Ä–º—ñ–Ω—É
2. –ö–æ—Ä–æ—Ç–∫–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è (2-3 —Ä–µ—á–µ–Ω–Ω—è)
–§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é:
**[–ù–∞–∑–≤–∞ —Ç–µ—Ä–º—ñ–Ω—É]**
[–ü–æ—è—Å–Ω–µ–Ω–Ω—è]
**[–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω]**
[–ü–æ—è—Å–Ω–µ–Ω–Ω—è]
–§–æ–∫—É—Å—É–π—Å—è –Ω–∞:
- –ö—É–ª—å—Ç—É—Ä–Ω–∏—Ö —Ä–µ–∞–ª—ñ—è—Ö —Ç–æ–≥–æ —á–∞—Å—É
- –†–µ–ª—ñ–≥—ñ–π–Ω–∏—Ö –ø–æ–Ω—è—Ç—Ç—è—Ö
- –Ü—Å—Ç–æ—Ä–∏—á–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ
- –ú–µ—Ç–∞—Ñ–æ—Ä–∞—Ö —ñ —Å–∏–º–≤–æ–ª–∞—Ö`;
                try {
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: this.MODEL_NAME,
                            messages: [
                                { role: 'system', content: '–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ –±—ñ–±–ª—ñ–π–Ω–æ—ó –≥–µ—Ä–º–µ–Ω–µ–≤—Ç–∏–∫–∏. –ü–æ—è—Å–Ω—é—î—à —Ç–µ—Ä–º—ñ–Ω–∏ –ø—Ä–æ—Å—Ç–æ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é.' },
                                { role: 'user', content: prompt }
                            ],
                            max_tokens: 1000,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    const aiText = data.choices[0].message.content;
                    this.lastAIResponse = { type: 'dictionary', reference: reading.reference, theme: '–ë—ñ–±–ª—ñ–π–Ω—ñ —Ç–µ—Ä–º—ñ–Ω–∏', content: aiText };
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').style.display = 'block';
                    document.getElementById('aiHelpResponse').innerHTML = `
                        <div class="ai-response-box" style="border-left-color: #673ab7;">
                            <h3 style="color: #673ab7; margin-bottom: 15px;">üìö –°–ª–æ–≤–Ω–∏–∫ —Ç–µ—Ä–º—ñ–Ω—ñ–≤</h3>
                            <div style="line-height: 1.8; white-space: pre-wrap;">${aiText}</div>
                        </div>
                        <div class="share-buttons">
                            <a href="#" onclick="app.shareToTelegram(); return false;" class="share-btn share-telegram">üì§ –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –≤ Telegram</a>
                            <a href="#" onclick="app.saveAsTextFile(); return false;" class="share-btn share-save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ —Ñ–∞–π–ª</a>
                        </div>`;
                } catch (err) {
                    console.error(err);
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').innerHTML = `<div style="color:#f44336;">‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å–ª–æ–≤–Ω–∏–∫–∞.</div>`;
                }
            },
            /* üîó –ó–≤‚Äô—è–∑–∫–∏ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏ —á–∏—Ç–∞–Ω–Ω—è–º–∏ */
            async getConnections(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const reading = plan.readings[readingIndex];
                this.currentReading = { planId, readingIndex, reading };
                const previousReadings = plan.readings
                    .slice(0, readingIndex)
                    .filter(r => r.completed)
                    .map(r => r.reference)
                    .slice(-5);
                const nextReading = plan.readings[readingIndex + 1];
                 document.getElementById('aiReadingTitle').textContent = 'üîó –ó–≤‚Äô—è–∑–∫–∏';
                document.getElementById('aiReadingRef').textContent = reading.reference;
                document.getElementById('aiHelpResponse').style.display = 'none';
                document.getElementById('aiHelpLoading').style.display = 'block';
                document.getElementById('aiModal').classList.add('active');
                let prompt = `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∑–≤'—è–∑–∫–∏ –º—ñ–∂ –±—ñ–±–ª—ñ–π–Ω–∏–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏.
–ü–û–¢–û–ß–ù–ï –ß–ò–¢–ê–ù–ù–Ø: ${reading.reference}
`;
                if (previousReadings.length)
                    prompt += `–ü–û–ü–ï–†–ï–î–ù–Ü –ß–ò–¢–ê–ù–ù–Ø: ${previousReadings.join(', ')}
–ó–Ω–∞–π–¥–∏ 2-3 –ö–û–ù–ö–†–ï–¢–ù–Ü –∑–≤'—è–∑–∫–∏ –º—ñ–∂ –ø–æ—Ç–æ—á–Ω–∏–º —á–∏—Ç–∞–Ω–Ω—è–º —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏:
- –°–ø—ñ–ª—å–Ω—ñ —Ç–µ–º–∏, —Ä–æ–∑–≤–∏—Ç–æ–∫ —ñ–¥–µ–π, –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∏, –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ—Ä–æ—Ü—Ç–≤, –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ —Å—é–∂–µ—Ç–∏
`;
                else
                    prompt += `–¶–µ –ø–µ—Ä—à–µ —á–∏—Ç–∞–Ω–Ω—è –≤ –ø–ª–∞–Ω—ñ. –î–∞–π –∑–∞–≥–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: —â–æ –±—É–ª–æ –¥–æ —Ü—å–æ–≥–æ —ñ —â–æ –±—É–¥–µ –¥–∞–ª—ñ.
`;
                if (nextReading) prompt += `–ù–ê–°–¢–£–ü–ù–ï –ß–ò–¢–ê–ù–ù–Ø: ${nextReading.reference}
–ö–æ—Ä–æ—Ç–∫–æ –ø–æ–∫–∞–∂–∏, —è–∫ –ø–æ—Ç–æ—á–Ω–µ —á–∏—Ç–∞–Ω–Ω—è –≥–æ—Ç—É—î –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ.
`;
                prompt += `–§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é:
üìñ **[–ü–æ–ø–µ—Ä–µ–¥–Ω—î —á–∏—Ç–∞–Ω–Ω—è]**
[–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∑–≤'—è–∑–æ–∫]
üîÆ **–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ**
[–Ø–∫ —Ü–µ –≤–µ–¥–µ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —á–∏—Ç–∞–Ω–Ω—è]
–ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º, –≤–∫–∞–∑—É–π –≤—ñ—Ä—à—ñ.`;
                try {
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: this.MODEL_NAME,
                            messages: [
                                { role: 'system', content: '–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ –±—ñ–±–ª—ñ–π–Ω–æ—ó —Ç–µ–æ–ª–æ–≥—ñ—ó, –ø–æ–∫–∞–∑—É—î—à –∑–≤‚Äô—è–∑–∫–∏ –º—ñ–∂ —Ç–µ–∫—Å—Ç–∞–º–∏. –£–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é.' },
                                { role: 'user', content: prompt }
                            ],
                            max_tokens: 1000,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    const aiText = data.choices[0].message.content;
                    this.lastAIResponse = { type: 'connections', reference: reading.reference, theme: '–ó–≤‚Äô—è–∑–∫–∏ –∑ —ñ–Ω—à–∏–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏', content: aiText };
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').style.display = 'block';
                    document.getElementById('aiHelpResponse').innerHTML = `
                        <div class="ai-response-box" style="border-left-color: #e91e63;">
                            <h3 style="color: #e91e63; margin-bottom: 15px;">üîó –ó–≤‚Äô—è–∑–∫–∏ –º—ñ–∂ —á–∏—Ç–∞–Ω–Ω—è–º–∏</h3>
                            <div style="line-height: 1.8; white-space: pre-wrap;">${aiText}</div>
                        </div>
                        ${previousReadings.length === 0 ? `
                            <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #ff9800;">
                                <strong>üí° –ü–æ—Ä–∞–¥–∞:</strong> –ü—Ä–æ–¥–æ–≤–∂—É–π—Ç–µ —á–∏—Ç–∞—Ç–∏ –∑–∞ –ø–ª–∞–Ω–æ–º, —ñ –®–Ü –±—É–¥–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∑–≤'—è–∑–∫–∏ –º—ñ–∂ —Ç–µ–∫—Å—Ç–∞–º–∏, —è–∫—ñ –≤–∏ –≤–∂–µ –ø—Ä–æ—á–∏—Ç–∞–ª–∏!
                            </div>` : ''}
                        <div class="share-buttons">
                            <a href="#" onclick="app.shareToTelegram(); return false;" class="share-btn share-telegram">üì§ –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –≤ Telegram</a>
                            <a href="#" onclick="app.saveAsTextFile(); return false;" class="share-btn share-save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ —Ñ–∞–π–ª</a>
                        </div>`;
                } catch (err) {
                    console.error(err);
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').innerHTML = `<div style="color:#f44336;">‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∑–≤‚Äô—è–∑–∫—ñ–≤.</div>`;
                }
            },
            /* ========== –û–ë–ù–û–í–õ–Å–ù–ù–´–ï SHARE-–ú–ï–¢–û–î–´ ========== */
            shareToTelegram() {
                if (!this.lastAIResponse) return;
                const typeNames = {
                    summary: 'üìñ –ö–æ—Ä–æ—Ç–∫–∏–π –æ–≥–ª—è–¥',
                    context: 'üìñ –ö–æ–Ω—Ç–µ–∫—Å—Ç',
                    parallels: 'üìñ –ü–∞—Ä–∞–ª–µ–ª—ñ',
                    application: 'üìñ –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è',
                    dictionary: 'üìö –°–ª–æ–≤–Ω–∏–∫ —Ç–µ—Ä–º—ñ–Ω—ñ–≤',
                    connections: 'üîó –ó–≤‚Äô—è–∑–∫–∏ –º—ñ–∂ —á–∏—Ç–∞–Ω–Ω—è–º–∏'
                };
                const title = `üìñ ${this.lastAIResponse.reference}`;
                const theme = this.lastAIResponse.theme;
                const type = typeNames[this.lastAIResponse.type] || '–®–Ü-–ø–æ–º—ñ—á–Ω–∏–∫';
                const content = this.lastAIResponse.content;
                const text = `${title}
${type}
${theme}
${content}`;
                const url = `https://t.me/share/url?url=${encodeURIComponent(' ')}&text=${encodeURIComponent(text)}`;
                window.open(url, '_blank');
            },
            saveAsTextFile() {
                if (!this.lastAIResponse) return;
                const typeNames = {
                    summary: '–ö–æ—Ä–æ—Ç–∫–∏–π –æ–≥–ª—è–¥',
                    context: '–ö–æ–Ω—Ç–µ–∫—Å—Ç',
                    parallels: '–ü–∞—Ä–∞–ª–µ–ª—ñ',
                    application: '–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è',
                    dictionary: '–°–ª–æ–≤–Ω–∏–∫ —Ç–µ—Ä–º—ñ–Ω—ñ–≤',
                    connections: '–ó–≤‚Äô—è–∑–∫–∏ –º—ñ–∂ —á–∏—Ç–∞–Ω–Ω—è–º–∏'
                };
                const title = `${this.lastAIResponse.reference}`;
                const type = typeNames[this.lastAIResponse.type] || 'AI-–≤—ñ–¥–ø–æ–≤—ñ–¥—å';
                const content = this.lastAIResponse.content;
                const text = `–ë—ñ–±–ª—ñ–π–Ω–µ —á–∏—Ç–∞–Ω–Ω—è: ${title}
–¢–∏–ø: ${type}
${content}`;
                const now = new Date();
                const timestamp = now.toISOString().replace(/[:.]/g, '-');
                const filename = `bible_ai_${this.lastAIResponse.type}_${timestamp}.txt`;
                const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
                const blob = new Blob([bom, text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            },
            /* ========== –û–°–¢–ê–õ–¨–ù–´–ï –ú–ï–¢–û–î–´ (generateYearPlan, exportData –∏ —Ç.–¥.) ========== */
            generateYearPlan() {
                const books = [
                    { name: '–ë—É—Ç—Ç—è', chapters: 50 }, { name: '–í–∏—Ö—ñ–¥', chapters: 40 },
                    { name: '–õ–µ–≤–∏—Ç', chapters: 27 }, { name: '–ß–∏—Å–ª–∞', chapters: 36 }
                ];
                const readings = [];
                let day = 0;
                for (let i = 0; i < Math.min(30, books.length); i++) {
                    const book = books[i];
                    const chaptersPerDay = Math.ceil(book.chapters / 3);
                    for (let start = 1; start <= book.chapters; start += chaptersPerDay) {
                        const end = Math.min(start + chaptersPerDay - 1, book.chapters);
                        readings.push({
                            reference: `${book.name} ${start}${end > start ? '-' + end : ''}`,
                            theme: `${book.name}`,
                            description: `–ß–∏—Ç–∞–Ω–Ω—è –∫–Ω–∏–≥–∏ ${book.name}`,
                            completed: false,
                            completedDate: null,
                            notes: ''
                        });
                        day++;
                        if (day >= 30) break;
                    }
                    if (day >= 30) break;
                }
                return readings;
            },
            generateNTPlan() {
                const ntBooks = [
                    '–ú–∞—Ç–≤—ñ—è', '–ú–∞—Ä–∫–∞', '–õ—É–∫–∏', '–Ü–æ–∞–Ω–∞', '–î—ñ—ó', '–†–∏–º–ª—è–Ω–∞–º', 
                    '1 –ö–æ—Ä–∏–Ω—Ç—è–Ω–∞–º', '2 –ö–æ—Ä–∏–Ω—Ç—è–Ω–∞–º', '–ì–∞–ª–∞—Ç–∞–º'
                ];
                return ntBooks.slice(0, 30).map((book, i) => ({
                    reference: `${book} 1-3`,
                    theme: book,
                    description: `–ß–∏—Ç–∞–Ω–Ω—è –∫–Ω–∏–≥–∏ ${book}`,
                    completed: false,
                    completedDate: null,
                    notes: ''
                }));
            },
            generateGospelsPlan() {
                const gospels = [
                    { name: '–ú–∞—Ç–≤—ñ—è', chapters: 28 },
                    { name: '–ú–∞—Ä–∫–∞', chapters: 16 },
                    { name: '–õ—É–∫–∏', chapters: 24 },
                    { name: '–Ü–æ–∞–Ω–∞', chapters: 21 }
                ];
                const readings = [];
                gospels.forEach(gospel => {
                    const chaptersPerDay = Math.ceil(gospel.chapters / 7);
                    for (let start = 1; start <= gospel.chapters; start += chaptersPerDay) {
                        const end = Math.min(start + chaptersPerDay - 1, gospel.chapters);
                        readings.push({
                            reference: `${gospel.name} ${start}-${end}`,
                            theme: gospel.name,
                            description: `–ß–∏—Ç–∞–Ω–Ω—è —î–≤–∞–Ω–≥–µ–ª—ñ—è –≤—ñ–¥ ${gospel.name}`,
                            completed: false,
                            completedDate: null,
                            notes: ''
                        });
                    }
                });
                return readings;
            },
            generatePsalmsPlan() {
                const readings = [];
                for (let i = 1; i <= 30; i++) {
                    readings.push({
                        reference: `–ü—Å–∞–ª–æ–º ${i}`,
                        theme: `–ü—Å–∞–ª–æ–º ${i}`,
                        description: '–ß–∏—Ç–∞–Ω–Ω—è –±—ñ–±–ª—ñ–π–Ω–æ–≥–æ –ø—Å–∞–ª–º—É',
                        completed: false,
                        completedDate: null,
                        notes: ''
                    });
                }
                return readings;
            },
            generateWisdomPlan() {
                const readings = [];
                const books = [
                    { name: '–ü—Ä–∏—Ç—á—ñ', chapters: 31 },
                    { name: '–ï–∫–∫–ª–µ–∑—ñ–∞—Å—Ç', chapters: 12 },
                    { name: '–ô–æ–≤–∞', chapters: 42 }
                ];
                books.forEach(book => {
                    for (let i = 1; i <= Math.min(book.chapters, 10); i++) {
                        readings.push({
                            reference: `${book.name} ${i}`,
                            theme: book.name,
                            description: `–ß–∏—Ç–∞–Ω–Ω—è –∫–Ω–∏–≥–∏ –º—É–¥—Ä–æ—Å—Ç—ñ: ${book.name}`,
                            completed: false,
                            completedDate: null,
                            notes: ''
                        });
                    }
                });
                return readings;
            },
            exportData() {
                const dataStr = JSON.stringify(this.plans, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `bible_plans_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            },
            openHelp() {
                document.getElementById('helpModal').classList.add('active');
            },
            closeHelp() {
                document.getElementById('helpModal').classList.remove('active');
            }
        };
        window.addEventListener('DOMContentLoaded', () => app.init());
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                app.closeCreateModal();
                app.closeAIModal();
                app.closeHelp();
            }
        });
        document.getElementById('createModal').addEventListener('click', (e) => {
            if (e.target.id === 'createModal') app.closeCreateModal();
        });
        document.getElementById('aiModal').addEventListener('click', (e) => {
            if (e.target.id === 'aiModal') app.closeAIModal();
        });
        document.getElementById('helpModal').addEventListener('click', (e) => {
            if (e.target.id === 'helpModal') app.closeHelp();
        });
    </script>
</body>
</html>