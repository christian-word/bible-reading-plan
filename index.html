<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="sddefault.jpg">
    <title>Біблійні читання</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); text-align: center; }
        h1 { color: #4a90e2; font-size: 2.5em; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 1.1em; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: rgba(255, 255, 255, 0.95); padding: 14px 10px; border-radius: 12px; box-shadow: 0 3px 12px rgba(0,0,0,0.08); text-align: center; transition: transform 0.2s ease; min-height: 80px; display: flex; flex-direction: column; justify-content: center; }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-number { font-size: 1.8em; font-weight: bold; color: #4a90e2; display: block; }
        .stat-label { color: #666; margin-top: 4px; font-size: 0.8em; }
        .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 10px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4a90e2, #357abd); transition: width 0.3s ease; }
        .main-content { display: grid; grid-template-columns: 300px 1fr; gap: 20px; margin-bottom: 20px; }
        .sidebar { background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); height: fit-content; position: sticky; top: 20px; }
        .create-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; border: none; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-bottom: 20px; transition: transform 0.2s; }
        .create-btn:hover { transform: scale(1.05); }
        .menu-section { margin-bottom: 20px; }
        .menu-section h3 { color: #4a90e2; margin-bottom: 10px; font-size: 1em; }
        .menu-item { padding: 12px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover, .menu-item.active { background: #4a90e2; color: white; border-color: #4a90e2; }
        .content-area { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .readings-grid { display: grid; gap: 15px; }
        .reading-card { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s; position: relative; }
        .reading-card:hover { box-shadow: 0 5px 20px rgba(74, 144, 226, 0.3); border-color: #4a90e2; }
        .reading-card.completed { border-left: 5px solid #4caf50; background: #f1f8f4; }
        .reading-card.current { border-left: 5px solid #ff9800; }
        .reading-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .reading-title { font-size: 1.3em; font-weight: bold; color: #333; }
        .reading-reference { color: #4a90e2; font-weight: 600; margin-bottom: 8px; }
        .reading-description { color: #666; line-height: 1.6; margin-bottom: 15px; font-size: 0.95em; }
        .reading-meta { display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.9em; color: #999; margin-bottom: 15px; }
        .checkbox-label { display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 600; }
        .checkbox-label input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .reading-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em; transition: all 0.3s; }
        .btn-ai { background: #9c27b0; color: white; }
        .btn-note { background: #2196f3; color: white; }
        .btn-delete { background: #f44336; color: white; }
        /* новые кнопки */
        .btn-dictionary { background: #673ab7; color: white; }
        .btn-connections { background: #e91e63; color: white; }
        .dictionary-term {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #673ab7;
        }
        .dictionary-term strong {
            color: #673ab7;
            font-size: 1.1em;
            display: block;
            margin-bottom: 8px;
        }
        .connection-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #e91e63;
        }
        .connection-card strong {
            color: #e91e63;
            display: block;
            margin-bottom: 8px;
        }
        .notes-section { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 15px; display: none; }
        .notes-section.active { display: block; }
        .notes-section textarea { width: 100%; min-height: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; resize: vertical; font-family: inherit; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { color: #4a90e2; }
        .close-btn { font-size: 2em; cursor: pointer; color: #999; border: none; background: none; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; font-family: inherit; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-actions { display: flex; gap: 10px; justify-content: flex-end; }
        .btn-primary { background: #4a90e2; color: white; padding: 12px 30px; }
        .btn-secondary { background: #e0e0e0; color: #333; padding: 12px 30px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 4em; margin-bottom: 20px; }
        .plan-templates { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .template-card { background: linear-gradient(135deg, #f5f7fa 0%, #e3edf7 100%); padding: 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; text-align: center; }
        .template-card:hover { transform: translateY(-3px); border-color: #4a90e2; box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3); }
        .template-icon { font-size: 2.5em; margin-bottom: 10px; }
        .template-title { font-weight: bold; color: #333; margin-bottom: 5px; }
        .template-desc { font-size: 0.85em; color: #666; }
        .ai-suggestions { background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid #9c27b0; }
        .ai-response-box { background: linear-gradient(135deg, #f3e5f522 0%, #e1bee733 100%); padding: 20px; border-radius: 12px; border-left: 5px solid #9c27b0; margin-top: 15px; }
        .loading { text-align: center; padding: 40px; }
        .spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid #e0e0e0; border-top-color: #4a90e2; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .tag { display: inline-block; padding: 4px 12px; background: #e3f2fd; color: #1976d2; border-radius: 15px; font-size: 0.85em; margin-right: 5px; }
        .share-buttons { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .share-btn { padding: 10px 20px; border-radius: 8px; text-decoration: none; color: white; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; transition: transform 0.2s; }
        .share-btn:hover { transform: scale(1.05); }
        .share-telegram { background: #0088cc; }
        .share-save { background: #4caf50; }
        @media (max-width: 968px) { 
            .main-content { grid-template-columns: 1fr; } 
            h1 { font-size: 1.8em; } 
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .sidebar { position: static; }
            .form-group textarea { min-height: 150px; font-size: 16px; }
            .form-group select { font-size: 16px; padding: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Біблійні читання</h1>
            <p class="subtitle">"Слово Твоє — світильник нозі моїй і світло стежці моїй" - Псалом 119:105</p>
        </header>
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="totalReadings">0</span>
                <div class="stat-label">Всього читань</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="completedReadings">0</span>
                <div class="stat-label">Завершено</div>
                <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="currentStreak">0</span>
                <div class="stat-label">Поточна серія</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="notesCount">0</span>
                <div class="stat-label">Нотатки</div>
            </div>
        </div>
        <div class="main-content">
            <aside class="sidebar">
                <button class="create-btn" onclick="app.openCreateModal()">+ Створити план</button>
                <div class="menu-section">
                    <h3>Мої плани</h3>
                    <div id="plansList"></div>
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="app.exportData()">📥 Експорт</button>
                    <button class="btn btn-secondary" style="width: 100%;" onclick="app.openHelp()">? Допомога</button>
                </div>
            </aside>
            <main class="content-area">
                <div id="contentArea">
                    <div class="empty-state">
                        <div class="empty-state-icon">📖</div>
                        <h3>Немає активного плану</h3>
                        <p>Створіть новий план читання для початку</p>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <!-- Modal: Create Plan -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>+ Створити план читання</h2>
                <button class="close-btn" onclick="app.closeCreateModal()">&times;</button>
            </div>
            <div class="plan-templates">
                <div class="template-card" onclick="app.selectTemplate('custom')">
                    <div class="template-icon">✏️</div>
                    <div class="template-title">Свій план</div>
                    <div class="template-desc">Власний план читання</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('year')">
                    <div class="template-icon">📅</div>
                    <div class="template-title">Рік</div>
                    <div class="template-desc">365 днів</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('nt')">
                    <div class="template-icon">✝️</div>
                    <div class="template-title">Новий Заповіт</div>
                    <div class="template-desc">3 місяці</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('gospels')">
                    <div class="template-icon">📖</div>
                    <div class="template-title">Євангелія</div>
                    <div class="template-desc">30 днів</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('psalms')">
                    <div class="template-icon">🎵</div>
                    <div class="template-title">Псалми</div>
                    <div class="template-desc">150 псалмів</div>
                </div>
                <div class="template-card" onclick="app.selectTemplate('wisdom')">
                    <div class="template-icon">🧠</div>
                    <div class="template-title">Мудрість</div>
                    <div class="template-desc">Притчі, Екклезіаст</div>
                </div>
            </div>
            <div class="ai-suggestions">
                <h3 style="margin-bottom: 15px;">🤖 AI допоможе створити план</h3>
                <div class="form-group">
                    <label>Опишіть бажаний план читання:</label>
                    <select id="aiPreset" onchange="app.selectAIPreset()" style="margin-bottom: 10px;">
                        <option value="">-- Оберіть шаблон --</option>
                        <option value="Читання Біблії повністю за 7 днів">Читання повністю (7 днів)</option>
                        <option value="Читання Нового Заповіту за 7 днів">НЗ за тиждень (7 днів)</option>
                        <option value="Читання Псалмів і Пророків за 2 тижні">Псалми і Пророки (14 днів)</option>
                        <option value="Читання Біблії по порядку за 7 днів">По порядку (7 днів)</option>
                        <option value="Читання Біблії по темах за 10 днів">По темах (10 днів)</option>
                        <option value="Читання Біблії з поясненнями за 2 тижні">З поясненнями (14 днів)</option>
                        <option value="Читання Біблії з молитвами і роздумами 7 днів">З молитвами і роздумами (7 днів)</option>
                        <option value="Читання Біблії з життя Ісуса Христа за 7 днів">Життя Ісуса Христа (7 днів)</option>
                        <option value="Читання Біблії з акцентом на милосердя за 10 днів">Акцент на милосердя (10 днів)</option>
                        <option value="Читання Біблії з пророків за 9 днів">Пророки (9 днів)</option>
                        <option value="Читання Біблії з Псалмами і Притчами за 7 днів">Псалми і Притчі (7 днів)</option>
                        <option value="Читання Біблії з акцентом на надію і віру 7 днів">Акцент на надію і віру (7 днів)</option>
                        <option value="Читання Біблії з акцентом на любов і прощення 7 днів">Акцент на любов і прощення (7 днів)</option>
                        <option value="Читання Біблії з акцентом на справедливість 10 днів">Акцент на справедливість (10 днів)</option>
                        <option value="Читання Біблії з акцентом на мудрість 14 днів">Акцент на мудрість (14 днів)</option>
                        <option value="Читання Біблії з акцентом на покаяння 7 днів">Акцент на покаяння (7 днів)</option>
                        <option value="Читання Біблії з акцентом на віру і довіру 10 днів">Акцент на віру і довіру (10 днів)</option>
                        <option value="Читання Біблії з акцентом на служіння 7 днів">Акцент на служіння (7 днів)</option>
                        <option value="Читання Біблії з акцентом на Царство Боже 30 днів">Акцент на Царство Боже (30 днів)</option>
                        <option value="Читання Біблії з акцентом на життя в Дусі 14 днів">Акцент на життя в Дусі (14 днів)</option>
                    </select>
                    <textarea id="aiPrompt" placeholder="Наприклад: Створи план читання з акцентом на милосердя на 10 днів..." style="min-height: 80px;"></textarea>
                </div>
                <button class="btn btn-primary" onclick="app.generateAIPlan()">🤖 Згенерувати план</button>
            </div>
            <div id="manualPlanForm" style="display: none;">
                <form onsubmit="app.saveManualPlan(event)">
                    <div class="form-group">
                        <label>Назва плану *</label>
                        <input type="text" id="planName" required>
                    </div>
                    <div class="form-group">
                        <label>Опис</label>
                        <textarea id="planDescription"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="app.closeCreateModal()">Скасувати</button>
                        <button type="submit" class="btn btn-primary">Створити</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Modal: AI Helper -->
    <div class="modal" id="aiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🤖 AI-помічник</h2>
                <button class="close-btn" onclick="app.closeAIModal()">&times;</button>
            </div>
            <div style="margin-bottom: 20px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <strong id="aiReadingTitle"></strong>
                    <p id="aiReadingRef" style="color: #4a90e2; margin-top: 5px;"></p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="app.getAIHelp('summary')">📖 Короткий огляд</button>
                    <button class="btn btn-primary" onclick="app.getAIHelp('context')">📖 Контекст</button>
                    <button class="btn btn-primary" onclick="app.getAIHelp('parallels')">📖 Паралелі</button>
                    <button class="btn btn-primary" onclick="app.getAIHelp('application')">📖 Застосування</button>
                </div>
                <div id="aiHelpResponse" style="display: none;"></div>
                <div id="aiHelpLoading" style="display: none;" class="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 15px; color: #666;">Завантаження...</p>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="btn btn-secondary" onclick="app.closeAIModal()">Закрити</button>
            </div>
        </div>
    </div>
    <!-- Modal: Help -->
    <div class="modal" id="helpModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>? Допомога</h2>
                <button class="close-btn" onclick="app.closeHelp()">&times;</button>
            </div>
            <div style="line-height: 1.8; color: #333;">
                <div style="background: linear-gradient(135deg, #4a90e222 0%, #357abd33 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px; border-left: 5px solid #4a90e2;">
                    <h3 style="color: #4a90e2; margin-bottom: 10px;">🎉 Ласкаво просимо!</h3>
                    <p>Цей додаток допоможе вам організувати читання Біблії. Створюйте плани, відмічайте прочитане, робіть нотатки та отримуйте допомогу від AI.</p>
                </div>
                <h3 style="color: #4a90e2; margin-bottom: 15px;">? Як користуватися</h3>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #2196f3; margin-bottom: 8px;">1. Створення плану</h4>
                    <p>Натисніть кнопку "+ Створити план" та оберіть шаблон або скористайтеся AI для генерації плану читання.</p>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #4caf50; margin-bottom: 8px;">2. Відмічання читань</h4>
                    <p>Після прочитання відмітьте читання як завершене. Це допоможе відстежувати прогрес.</p>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #9c27b0; margin-bottom: 8px;">3. AI-помічник</h4>
                    <p>Натисніть "🤖 AI-помічник" на будь-якому читанні, щоб отримати короткий огляд, контекст, паралелі та практичне застосування.</p>
                </div>
                <h3 style="color: #4a90e2; margin-bottom: 15px; margin-top: 25px;">? Можливості AI</h3>
                <ul style="padding-left: 20px;">
                    <li><strong>Короткий огляд:</strong> AI надає стислий зміст читання</li>
                    <li><strong>Контекст:</strong> Історичний та богословський контекст</li>
                    <li><strong>Паралелі:</strong> Пошук схожих уривків у Біблії</li>
                    <li><strong>Застосування:</strong> Практичні поради для життя</li>
                    <li><strong>Збереження:</strong> Зберігайте AI-відповіді як текстові файли</li>
                </ul>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; border-left: 5px solid #4caf50; margin-top: 20px;">
                    <p style="margin: 0;"><strong>? Важливо:</strong> AI — це допоміжний інструмент, а не авторитетна інтерпретація Святого Письма.</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="app.closeHelp()">Зрозуміло! Дякую</button>
            </div>
        </div>
    </div>
    <script>
        const app = {
            plans: [],
            currentPlan: null,
            currentReading: null,
            lastAIResponse: null,
            API_KEY: atob("Z3NrX1NUelQyS1FFQko3MGNDb1hDSllaV0dkeWIzRlk5OHJHN2xvWXUxSmc1SnV0VFZOSzIyVHY="),
            API_URL: "https://api.groq.com/openai/v1/chat/completions",
            MODEL_NAME: "meta-llama/llama-4-maverick-17b-128e-instruct",
            init() {
                this.loadPlans();
                this.updateStats();
                this.renderPlans();
                this.renderContent();
            },
            loadPlans() {
                const saved = localStorage.getItem('biblePlans');
                if (saved) {
                    this.plans = JSON.parse(saved);
                }
            },
            savePlans() {
                localStorage.setItem('biblePlans', JSON.stringify(this.plans));
                this.updateStats();
                this.renderPlans();
                this.renderContent();
            },
            updateStats() {
                let totalReadings = 0;
                let completedReadings = 0;
                let notesCount = 0;
                let lastReadDate = null;
                this.plans.forEach(plan => {
                    totalReadings += plan.readings.length;
                    plan.readings.forEach(r => {
                        if (r.completed) {
                            completedReadings++;
                            if (r.completedDate) {
                                const date = new Date(r.completedDate).toDateString();
                                if (!lastReadDate || new Date(r.completedDate) > new Date(lastReadDate)) {
                                    lastReadDate = r.completedDate;
                                }
                            }
                        }
                        if (r.notes) notesCount++;
                    });
                });
                const streak = this.calculateStreak();
                const progress = totalReadings > 0 ? Math.round((completedReadings / totalReadings) * 100) : 0;
                document.getElementById('totalReadings').textContent = totalReadings;
                document.getElementById('completedReadings').textContent = completedReadings;
                document.getElementById('currentStreak').textContent = streak;
                document.getElementById('notesCount').textContent = notesCount;
                document.getElementById('progressBar').style.width = progress + '%';
            },
            calculateStreak() {
                const allReadings = [];
                this.plans.forEach(plan => {
                    plan.readings.forEach(r => {
                        if (r.completed && r.completedDate) {
                            allReadings.push(new Date(r.completedDate));
                        }
                    });
                });
                if (allReadings.length === 0) return 0;
                allReadings.sort((a, b) => b - a);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                let streak = 0;
                let checkDate = new Date(today);
                for (let i = 0; i < allReadings.length; i++) {
                    const readDate = new Date(allReadings[i]);
                    readDate.setHours(0, 0, 0, 0);
                    if (readDate.getTime() === checkDate.getTime()) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else if (readDate < checkDate) {
                        break;
                    }
                }
                return streak;
            },
            renderPlans() {
                const container = document.getElementById('plansList');
                if (this.plans.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Немає планів</div>';
                    return;
                }
                container.innerHTML = this.plans.map((plan, index) => {
                    const completed = plan.readings.filter(r => r.completed).length;
                    const total = plan.readings.length;
                    const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                    const isActive = this.currentPlan && this.currentPlan.id === plan.id;
                    return `
                        <div class="menu-item ${isActive ? 'active' : ''}" onclick="app.selectPlan(${plan.id})">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; margin-bottom: 5px;">${plan.name}</div>
                                <div style="font-size: 0.85em; opacity: 0.8;">${completed}/${total} (${progress}%)</div>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            renderContent() {
                const container = document.getElementById('contentArea');
                if (!this.currentPlan) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">📖</div>
                            <h3>Немає активного плану</h3>
                            <p>Оберіть або створіть план читання</p>
                        </div>
                    `;
                    return;
                }
                const plan = this.currentPlan;
                const completed = plan.readings.filter(r => r.completed).length;
                const total = plan.readings.length;
                const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                container.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2 style="color: #4a90e2;">${plan.name}</h2>
                            ${plan.description ? `<p style="color: #666; margin-top: 5px;">${plan.description}</p>` : ''}
                        </div>
                        <button class="btn btn-delete" onclick="app.deletePlan(${plan.id})">🗑️ Видалити план</button>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span><strong>Прогрес:</strong> ${completed} з ${total}</span>
                            <span><strong>${progress}%</strong></span>
                        </div>
                        <div class="progress-bar" style="height: 10px;">
                            <div class="progress-fill" style="width: ${progress}%;"></div>
                        </div>
                    </div>
                    <div class="readings-grid">
                        ${plan.readings.map((reading, index) => `
                            <div class="reading-card ${reading.completed ? 'completed' : ''} ${index === 0 && !reading.completed ? 'current' : ''}">
                                <div class="reading-header">
                                    <div style="flex: 1;">
                                        <div class="reading-title">Читання ${index + 1}</div>
                                        <div class="reading-reference">${reading.reference}</div>
                                        ${reading.theme ? `<span class="tag">${reading.theme}</span>` : ''}
                                    </div>
                                    <label class="checkbox-label">
                                        <input type="checkbox" ${reading.completed ? 'checked' : ''} onchange="app.toggleComplete(${plan.id}, ${index})">
                                        <span>${reading.completed ? '✅ Завершено' : 'Завершити'}</span>
                                    </label>
                                </div>
                                ${reading.description ? `<div class="reading-description">${reading.description}</div>` : ''}
                                <div class="reading-meta">
                                    ${reading.completed && reading.completedDate ? `<span>📅 ${new Date(reading.completedDate).toLocaleDateString('uk-UA')}</span>` : ''}
                                    ${reading.notes ? `<span>📝 З нотатками</span>` : ''}
                                </div>
                                <div class="reading-actions">
                                    <button class="btn btn-ai" onclick="app.openAIHelper(${plan.id}, ${index})">🤖 AI-помічник</button>
                                    <button class="btn btn-note" onclick="app.toggleNotes(${plan.id}, ${index})">📝 Нотатки</button>
                                    <button class="btn btn-dictionary" onclick="app.getBibleDictionary(${plan.id}, ${index})">📚 Словник</button>
                                    <button class="btn btn-connections" onclick="app.getConnections(${plan.id}, ${index})">🔗 Зв’язки</button>
                                </div>
                                <div class="notes-section" id="notes-${plan.id}-${index}">
                                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ваші нотатки:</label>
                                    <textarea id="noteText-${plan.id}-${index}" onchange="app.saveNote(${plan.id}, ${index})">${reading.notes || ''}</textarea>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            },
            selectPlan(planId) {
                this.currentPlan = this.plans.find(p => p.id === planId);
                this.renderPlans();
                this.renderContent();
            },
            toggleComplete(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const reading = plan.readings[readingIndex];
                reading.completed = !reading.completed;
                reading.completedDate = reading.completed ? new Date().toISOString() : null;
                this.savePlans();
            },
            toggleNotes(planId, readingIndex) {
                const notesSection = document.getElementById(`notes-${planId}-${readingIndex}`);
                if (notesSection) {
                    notesSection.classList.toggle('active');
                }
            },
            saveNote(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const noteText = document.getElementById(`noteText-${plan.id}-${readingIndex}`).value;
                plan.readings[readingIndex].notes = noteText;
                this.savePlans();
            },
            deletePlan(planId) {
                if (!confirm('Ви впевнені, що хочете видалити цей план?')) return;
                this.plans = this.plans.filter(p => p.id !== planId);
                if (this.currentPlan && this.currentPlan.id === planId) {
                    this.currentPlan = null;
                }
                this.savePlans();
            },
            openCreateModal() {
                document.getElementById('createModal').classList.add('active');
                document.getElementById('manualPlanForm').style.display = 'none';
                document.getElementById('aiPrompt').value = '';
                document.getElementById('aiPreset').value = '';
            },
            closeCreateModal() {
                document.getElementById('createModal').classList.remove('active');
            },
            selectAIPreset() {
                const select = document.getElementById('aiPreset');
                const textarea = document.getElementById('aiPrompt');
                if (select.value) {
                    textarea.value = select.value;
                }
            },
            selectTemplate(template) {
                const templates = {
                    custom: {
                        name: 'Свій план',
                        description: 'Власний план читання',
                        readings: []
                    },
                    year: {
                        name: 'Читання на рік',
                        description: 'Повне читання Біблії за 365 днів',
                        readings: this.generateYearPlan()
                    },
                    nt: {
                        name: 'Новий Заповіт',
                        description: 'Читання Нового Заповіту за 90 днів',
                        readings: this.generateNTPlan()
                    },
                    gospels: {
                        name: 'Євангелія',
                        description: 'Читання чотирьох євангелій по порядку',
                        readings: this.generateGospelsPlan()
                    },
                    psalms: {
                        name: 'Псалми',
                        description: 'Всі 150 псалмів по порядку',
                        readings: this.generatePsalmsPlan()
                    },
                    wisdom: {
                        name: 'Книги мудрості',
                        description: 'Притчі, Екклезіаст, Книга Йова',
                        readings: this.generateWisdomPlan()
                    }
                };
                if (template === 'custom') {
                    document.getElementById('manualPlanForm').style.display = 'block';
                } else {
                    const planData = templates[template];
                    const plan = {
                        id: Date.now(),
                        name: planData.name,
                        description: planData.description,
                        readings: planData.readings,
                        createdDate: new Date().toISOString()
                    };
                    this.plans.unshift(plan);
                    this.currentPlan = plan;
                    this.savePlans();
                    this.closeCreateModal();
                }
            },
            saveManualPlan(e) {
                e.preventDefault();
                const plan = {
                    id: Date.now(),
                    name: document.getElementById('planName').value,
                    description: document.getElementById('planDescription').value,
                    readings: [],
                    createdDate: new Date().toISOString()
                };
                this.plans.unshift(plan);
                this.currentPlan = plan;
                this.savePlans();
                this.closeCreateModal();
            },
            async generateAIPlan() {
                const prompt = document.getElementById('aiPrompt').value.trim();
                if (!prompt) {
                    alert('Будь ласка, введіть опис, який план ви хочете створити');
                    return;
                }
                const loading = document.createElement('div');
                loading.className = 'loading';
                loading.innerHTML = '<div class="spinner"></div><p style="margin-top: 15px;">Генерація плану...</p>';
                document.querySelector('#createModal .modal-content').appendChild(loading);
                try {
                    const systemPrompt = `Ви — експерт з біблійних читань. Створіть план читання Біблії.
Вимоги: Поверніть виключно JSON з наступною структурою:
{
  "name": "Назва плану читання",
  "description": "Опис цього плану читання",
  "readings": [
    {
      "reference": "Книга глави:стіхи (наприклад: Матвія 5-7)",
      "theme": "Тема читання (1-3 слова)",
      "description": "Короткий опис цього читання (1 речення)"
    }
  ]
}
Вимоги:
- Використовуйте лише існуючі книги Біблії
- reference повинен бути коректним (наприклад: "Буття 1-2", "Псалом 23", "Римлянам 1-3")
- Кількість читань повинна бути розумною (7-90 днів)
- theme - коротка тема (наприклад: "Нагірна проповідь")
- description - 1 речення для опису`;
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: this.MODEL_NAME,
                            messages: [
                                { role: 'system', content: systemPrompt },
                                { role: 'user', content: prompt }
                            ],
                            max_tokens: 2000,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    let aiText = data.choices[0].message.content.trim();
                    aiText = aiText.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                    const planData = JSON.parse(aiText);
                    planData.readings = planData.readings.map(r => ({
                        ...r,
                        completed: false,
                        completedDate: null,
                        notes: ''
                    }));
                    const plan = {
                        id: Date.now(),
                        name: planData.name,
                        description: planData.description,
                        readings: planData.readings,
                        createdDate: new Date().toISOString(),
                        aiGenerated: true
                    };
                    this.plans.unshift(plan);
                    this.currentPlan = plan;
                    this.savePlans();
                    this.closeCreateModal();
                } catch (error) {
                    console.error('AI Error:', error);
                    alert('Помилка при генерації плану. Спробуйте ще раз або використайте інший опис.');
                } finally {
                    loading.remove();
                }
            },
            openAIHelper(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const reading = plan.readings[readingIndex];
                this.currentReading = { planId, readingIndex, reading };
                document.getElementById('aiReadingTitle').textContent = `Читання ${readingIndex + 1}`;
                document.getElementById('aiReadingRef').textContent = reading.reference;
                document.getElementById('aiHelpResponse').style.display = 'none';
                document.getElementById('aiModal').classList.add('active');
            },
            closeAIModal() {
                document.getElementById('aiModal').classList.remove('active');
                this.currentReading = null;
            },
            async getAIHelp(type) {
                if (!this.currentReading) return;
                const { reading } = this.currentReading;
                document.getElementById('aiHelpResponse').style.display = 'none';
                document.getElementById('aiHelpLoading').style.display = 'block';
                const prompts = {
                    summary: `Напиши короткий огляд (3-5 речень) біблійного уривку: ${reading.reference}. 
Пиши простою мовою. Не використовуй богословські терміни, якщо вони не необхідні.`,
                    context: `Поясни історичний контекст біблійного уривку: ${reading.reference}.
Опиши детально, 4-6 речень: хто автор, коли написано, для кого, яка ситуація, головна думка, культурний контекст.`,
                    parallels: `Знайди 3-4 паралельні уривки у Біблії для: ${reading.reference}.
Формат відповіді:
📖 [Посилання] - короткий опис паралелі
Опис повинен бути зрозумілим для сучасної людини.`,
                    application: `Як практично застосувати уривок ${reading.reference} у сучасному житті.
2-3 практичні поради:
📖 [Порада] - як саме це застосувати
Опис повинен бути конкретним і практичним.`
                };
                this.lastAIResponse = {
                    type: type,
                    reference: reading.reference,
                    theme: reading.theme || 'Біблійне читання'
                };
                try {
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: this.MODEL_NAME,
                            messages: [
                                {
                                    role: 'system',
                                    content: 'Ви — експерт з біблійних студій. Ваші відповіді повинні бути точними, зрозумілими та практичними. Не використовуйте надмірно богословську термінологію, пишіть простою мовою.'
                                },
                                {
                                    role: 'user',
                                    content: prompts[type]
                                }
                            ],
                            max_tokens: 600,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    const aiText = data.choices[0].message.content;
                    this.lastAIResponse.content = aiText;
                    const typeNames = {
                        summary: '📖 Короткий огляд',
                        context: '📖 Контекст',
                        parallels: '📖 Паралелі',
                        application: '📖 Застосування'
                    };
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').style.display = 'block';
                    document.getElementById('aiHelpResponse').innerHTML = `
                        <div class="ai-response-box">
                            <div style="line-height: 1.8; white-space: pre-wrap;">${aiText}</div>
                        </div>
                        <div class="share-buttons">
                            <a href="#" onclick="app.shareToTelegram(); return false;" class="share-btn share-telegram">
                                📤 Поділитися в Telegram
                            </a>
                            <a href="#" onclick="app.saveAsTextFile(); return false;" class="share-btn share-save">
                                💾 Зберегти як файл
                            </a>
                        </div>
                    `;
                } catch (error) {
                    console.error('AI Error:', error);
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').style.display = 'block';
                    document.getElementById('aiHelpResponse').innerHTML = `
                        <div class="ai-response-box">
                            <div style="color: #f44336;">Помилка при отриманні відповіді. Спробуйте ще раз.</div>
                        </div>
                    `;
                }
            },
            /* ========== НОВІ МЕТОДИ ========== */
            /* 📚 Словник біблійних термінів */
            async getBibleDictionary(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const reading = plan.readings[readingIndex];
                this.currentReading = { planId, readingIndex, reading };
                document.getElementById('aiReadingTitle').textContent = '📚 Словник термінів';
                document.getElementById('aiReadingRef').textContent = reading.reference;
                document.getElementById('aiHelpResponse').style.display = 'none';
                document.getElementById('aiHelpLoading').style.display = 'block';
                document.getElementById('aiModal').classList.add('active');
                const prompt = `Проаналізуй біблійний текст ${reading.reference} і знайди 4-6 найважливіших термінів або понять, які потребують пояснення.
Для КОЖНОГО терміну дай:
1. Назву терміну
2. Коротке пояснення (2-3 речення)
Формат відповіді українською:
**[Назва терміну]**
[Пояснення]
**[Наступний термін]**
[Пояснення]
Фокусуйся на:
- Культурних реаліях того часу
- Релігійних поняттях
- Історичному контексті
- Метафорах і символах`;
                try {
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: this.MODEL_NAME,
                            messages: [
                                { role: 'system', content: 'Ти - експерт з біблійної герменевтики. Пояснюєш терміни просто українською.' },
                                { role: 'user', content: prompt }
                            ],
                            max_tokens: 1000,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    const aiText = data.choices[0].message.content;
                    this.lastAIResponse = { type: 'dictionary', reference: reading.reference, theme: 'Біблійні терміни', content: aiText };
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').style.display = 'block';
                    document.getElementById('aiHelpResponse').innerHTML = `
                        <div class="ai-response-box" style="border-left-color: #673ab7;">
                            <h3 style="color: #673ab7; margin-bottom: 15px;">📚 Словник термінів</h3>
                            <div style="line-height: 1.8; white-space: pre-wrap;">${aiText}</div>
                        </div>
                        <div class="share-buttons">
                            <a href="#" onclick="app.shareToTelegram(); return false;" class="share-btn share-telegram">📤 Поділитися в Telegram</a>
                            <a href="#" onclick="app.saveAsTextFile(); return false;" class="share-btn share-save">💾 Зберегти як файл</a>
                        </div>`;
                } catch (err) {
                    console.error(err);
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').innerHTML = `<div style="color:#f44336;">❌ Помилка при завантаженні словника.</div>`;
                }
            },
            /* 🔗 Зв’язки з попередніми читаннями */
            async getConnections(planId, readingIndex) {
                const plan = this.plans.find(p => p.id === planId);
                if (!plan) return;
                const reading = plan.readings[readingIndex];
                this.currentReading = { planId, readingIndex, reading };
                const previousReadings = plan.readings
                    .slice(0, readingIndex)
                    .filter(r => r.completed)
                    .map(r => r.reference)
                    .slice(-5);
                const nextReading = plan.readings[readingIndex + 1];
                 document.getElementById('aiReadingTitle').textContent = '🔗 Зв’язки';
                document.getElementById('aiReadingRef').textContent = reading.reference;
                document.getElementById('aiHelpResponse').style.display = 'none';
                document.getElementById('aiHelpLoading').style.display = 'block';
                document.getElementById('aiModal').classList.add('active');
                let prompt = `Проаналізуй зв'язки між біблійними текстами.
ПОТОЧНЕ ЧИТАННЯ: ${reading.reference}
`;
                if (previousReadings.length)
                    prompt += `ПОПЕРЕДНІ ЧИТАННЯ: ${previousReadings.join(', ')}
Знайди 2-3 КОНКРЕТНІ зв'язки між поточним читанням та попередніми:
- Спільні теми, розвиток ідей, контрасти, виконання пророцтв, паралельні сюжети
`;
                else
                    prompt += `Це перше читання в плані. Дай загальний контекст: що було до цього і що буде далі.
`;
                if (nextReading) prompt += `НАСТУПНЕ ЧИТАННЯ: ${nextReading.reference}
Коротко покажи, як поточне читання готує до наступного.
`;
                prompt += `Формат відповіді українською:
📖 **[Попереднє читання]**
[Конкретний зв'язок]
🔮 **Підготовка до наступного**
[Як це веде до наступного читання]
Будь конкретним, вказуй вірші.`;
                try {
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: this.MODEL_NAME,
                            messages: [
                                { role: 'system', content: 'Ти - експерт з біблійної теології, показуєш зв’язки між текстами. Українською.' },
                                { role: 'user', content: prompt }
                            ],
                            max_tokens: 1000,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    const aiText = data.choices[0].message.content;
                    this.lastAIResponse = { type: 'connections', reference: reading.reference, theme: 'Зв’язки з іншими текстами', content: aiText };
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').style.display = 'block';
                    document.getElementById('aiHelpResponse').innerHTML = `
                        <div class="ai-response-box" style="border-left-color: #e91e63;">
                            <h3 style="color: #e91e63; margin-bottom: 15px;">🔗 Зв’язки між читаннями</h3>
                            <div style="line-height: 1.8; white-space: pre-wrap;">${aiText}</div>
                        </div>
                        ${previousReadings.length === 0 ? `
                            <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #ff9800;">
                                <strong>💡 Порада:</strong> Продовжуйте читати за планом, і ШІ буде показувати зв'язки між текстами, які ви вже прочитали!
                            </div>` : ''}
                        <div class="share-buttons">
                            <a href="#" onclick="app.shareToTelegram(); return false;" class="share-btn share-telegram">📤 Поділитися в Telegram</a>
                            <a href="#" onclick="app.saveAsTextFile(); return false;" class="share-btn share-save">💾 Зберегти як файл</a>
                        </div>`;
                } catch (err) {
                    console.error(err);
                    document.getElementById('aiHelpLoading').style.display = 'none';
                    document.getElementById('aiHelpResponse').innerHTML = `<div style="color:#f44336;">❌ Помилка при завантаженні зв’язків.</div>`;
                }
            },
            /* ========== ОБНОВЛЁННЫЕ SHARE-МЕТОДЫ ========== */
            shareToTelegram() {
                if (!this.lastAIResponse) return;
                const typeNames = {
                    summary: '📖 Короткий огляд',
                    context: '📖 Контекст',
                    parallels: '📖 Паралелі',
                    application: '📖 Застосування',
                    dictionary: '📚 Словник термінів',
                    connections: '🔗 Зв’язки між читаннями'
                };
                const title = `📖 ${this.lastAIResponse.reference}`;
                const theme = this.lastAIResponse.theme;
                const type = typeNames[this.lastAIResponse.type] || 'ШІ-помічник';
                const content = this.lastAIResponse.content;
                const text = `${title}
${type}
${theme}
${content}`;
                const url = `https://t.me/share/url?url=${encodeURIComponent(' ')}&text=${encodeURIComponent(text)}`;
                window.open(url, '_blank');
            },
            saveAsTextFile() {
                if (!this.lastAIResponse) return;
                const typeNames = {
                    summary: 'Короткий огляд',
                    context: 'Контекст',
                    parallels: 'Паралелі',
                    application: 'Застосування',
                    dictionary: 'Словник термінів',
                    connections: 'Зв’язки між читаннями'
                };
                const title = `${this.lastAIResponse.reference}`;
                const type = typeNames[this.lastAIResponse.type] || 'AI-відповідь';
                const content = this.lastAIResponse.content;
                const text = `Біблійне читання: ${title}
Тип: ${type}
${content}`;
                const now = new Date();
                const timestamp = now.toISOString().replace(/[:.]/g, '-');
                const filename = `bible_ai_${this.lastAIResponse.type}_${timestamp}.txt`;
                const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
                const blob = new Blob([bom, text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            },
            /* ========== ОСТАЛЬНЫЕ МЕТОДЫ (generateYearPlan, exportData и т.д.) ========== */
            generateYearPlan() {
                const books = [
                    { name: 'Буття', chapters: 50 }, { name: 'Вихід', chapters: 40 },
                    { name: 'Левит', chapters: 27 }, { name: 'Числа', chapters: 36 }
                ];
                const readings = [];
                let day = 0;
                for (let i = 0; i < Math.min(30, books.length); i++) {
                    const book = books[i];
                    const chaptersPerDay = Math.ceil(book.chapters / 3);
                    for (let start = 1; start <= book.chapters; start += chaptersPerDay) {
                        const end = Math.min(start + chaptersPerDay - 1, book.chapters);
                        readings.push({
                            reference: `${book.name} ${start}${end > start ? '-' + end : ''}`,
                            theme: `${book.name}`,
                            description: `Читання книги ${book.name}`,
                            completed: false,
                            completedDate: null,
                            notes: ''
                        });
                        day++;
                        if (day >= 30) break;
                    }
                    if (day >= 30) break;
                }
                return readings;
            },
            generateNTPlan() {
                const ntBooks = [
                    'Матвія', 'Марка', 'Луки', 'Іоана', 'Дії', 'Римлянам', 
                    '1 Коринтянам', '2 Коринтянам', 'Галатам'
                ];
                return ntBooks.slice(0, 30).map((book, i) => ({
                    reference: `${book} 1-3`,
                    theme: book,
                    description: `Читання книги ${book}`,
                    completed: false,
                    completedDate: null,
                    notes: ''
                }));
            },
            generateGospelsPlan() {
                const gospels = [
                    { name: 'Матвія', chapters: 28 },
                    { name: 'Марка', chapters: 16 },
                    { name: 'Луки', chapters: 24 },
                    { name: 'Іоана', chapters: 21 }
                ];
                const readings = [];
                gospels.forEach(gospel => {
                    const chaptersPerDay = Math.ceil(gospel.chapters / 7);
                    for (let start = 1; start <= gospel.chapters; start += chaptersPerDay) {
                        const end = Math.min(start + chaptersPerDay - 1, gospel.chapters);
                        readings.push({
                            reference: `${gospel.name} ${start}-${end}`,
                            theme: gospel.name,
                            description: `Читання євангелія від ${gospel.name}`,
                            completed: false,
                            completedDate: null,
                            notes: ''
                        });
                    }
                });
                return readings;
            },
            generatePsalmsPlan() {
                const readings = [];
                for (let i = 1; i <= 30; i++) {
                    readings.push({
                        reference: `Псалом ${i}`,
                        theme: `Псалом ${i}`,
                        description: 'Читання біблійного псалму',
                        completed: false,
                        completedDate: null,
                        notes: ''
                    });
                }
                return readings;
            },
            generateWisdomPlan() {
                const readings = [];
                const books = [
                    { name: 'Притчі', chapters: 31 },
                    { name: 'Екклезіаст', chapters: 12 },
                    { name: 'Йова', chapters: 42 }
                ];
                books.forEach(book => {
                    for (let i = 1; i <= Math.min(book.chapters, 10); i++) {
                        readings.push({
                            reference: `${book.name} ${i}`,
                            theme: book.name,
                            description: `Читання книги мудрості: ${book.name}`,
                            completed: false,
                            completedDate: null,
                            notes: ''
                        });
                    }
                });
                return readings;
            },
            exportData() {
                const dataStr = JSON.stringify(this.plans, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `bible_plans_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            },
            openHelp() {
                document.getElementById('helpModal').classList.add('active');
            },
            closeHelp() {
                document.getElementById('helpModal').classList.remove('active');
            }
        };
        window.addEventListener('DOMContentLoaded', () => app.init());
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                app.closeCreateModal();
                app.closeAIModal();
                app.closeHelp();
            }
        });
        document.getElementById('createModal').addEventListener('click', (e) => {
            if (e.target.id === 'createModal') app.closeCreateModal();
        });
        document.getElementById('aiModal').addEventListener('click', (e) => {
            if (e.target.id === 'aiModal') app.closeAIModal();
        });
        document.getElementById('helpModal').addEventListener('click', (e) => {
            if (e.target.id === 'helpModal') app.closeHelp();
        });
    </script>
</body>
</html>